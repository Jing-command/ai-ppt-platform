# API å¥‘çº¦å¼ºåˆ¶æ‰§è¡ŒæŒ‡å—

> âš ï¸ **ç¡¬æ€§è§„å®š**ï¼šæ‰€æœ‰ Agent å¿…é¡»éµå®ˆæœ¬æ–‡æ¡£è§„åˆ™ï¼Œè¿è€…å¯¼è‡´çš„åŠŸèƒ½å›žæ»šç”±è¿è§„ Agent è´Ÿè´£ã€‚

---

## ðŸŽ¯ æ ¸å¿ƒåŽŸåˆ™

### åŽŸåˆ™ 1: å¥‘çº¦ä¼˜å…ˆ
```
å˜æ›´é¡ºåºï¼š
1. æ›´æ–° API_CONTRACT.md
2. æ›´æ–° TypeScript/Python ç±»åž‹
3. å®žçŽ°ä»£ç 
4. è¿è¡Œæ£€æŸ¥è„šæœ¬
5. æäº¤ä»£ç 

âŒ ç¦æ­¢ï¼šå…ˆå†™ä»£ç ï¼ŒåŽè¡¥æ–‡æ¡£
```

### åŽŸåˆ™ 2: å•ä¸€çœŸç›¸æº
```
API_CONTRACT.md æ˜¯å”¯ä¸€å¯ä¿¡çš„ API å®šä¹‰ï¼š
- å‰ç«¯ä»¥æ­¤ä¸ºå‡†è°ƒç”¨ API
- åŽç«¯ä»¥æ­¤ä¸ºå‡†å®žçŽ°å“åº”
- æµ‹è¯•ä»¥æ­¤ä¸ºå‡†ç¼–å†™ç”¨ä¾‹

ä»»ä½•ä¸Žå¥‘çº¦ä¸ç¬¦çš„ä»£ç éƒ½æ˜¯ BUG
```

### åŽŸåˆ™ 3: ç ´åæ€§å˜æ›´éœ€ç‰ˆæœ¬å‡çº§
```
PATCH: å­—æ®µæ–°å¢žï¼ˆå‘åŽå…¼å®¹ï¼‰
  â””â”€ æ— éœ€ç‰ˆæœ¬å‡çº§

MINOR: ç«¯ç‚¹æ–°å¢žï¼ˆå‘åŽå…¼å®¹ï¼‰
  â””â”€ æ›´æ–°å¥‘çº¦ç‰ˆæœ¬å· v1.0 â†’ v1.1

MAJOR: å­—æ®µåˆ é™¤/é‡å‘½å/ç±»åž‹å˜æ›´
  â””â”€ å¿…é¡»å‡çº§ç‰ˆæœ¬ v1.0 â†’ v2.0
  â””â”€ å¿…é¡»ä¿ç•™æ—§ç‰ˆæœ¬ç«¯ç‚¹è‡³å°‘ 2 ä¸ªè¿­ä»£
```

---

## ðŸ“‹ å¼ºåˆ¶æ£€æŸ¥æ¸…å•

### æ¯æ¬¡ä»£ç å˜æ›´å‰å¿…é¡»æ£€æŸ¥ï¼š

- [ ] API_CONTRACT.md å·²æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] æ–°å¢žç«¯ç‚¹å·²åœ¨å¥‘çº¦ä¸­å®šä¹‰
- [ ] ä¿®æ”¹çš„å­—æ®µå·²åœ¨å¥‘çº¦ä¸­æ›´æ–°
- [ ] TypeScript ç±»åž‹ä¸Žå¥‘çº¦ä¸€è‡´
- [ ] Python Schema ä¸Žå¥‘çº¦ä¸€è‡´
- [ ] è¿è¡Œ `./scripts/check-contract.sh` é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

---

## ðŸ” æ£€æŸ¥è„šæœ¬ä½¿ç”¨

```bash
# 1. æ¯æ¬¡æäº¤å‰è¿è¡Œ
cd ai-ppt-platform
./scripts/check-contract.sh

# 2. å¦‚æžœæ£€æŸ¥å¤±è´¥ï¼Œä¿®å¤åŽé‡æ–°è¿è¡Œ
# 3. åªæœ‰é€šè¿‡åŽæ‰èƒ½æäº¤ä»£ç 
```

---

## ðŸ“ å¥‘çº¦æ›´æ–°è§„èŒƒ

### æ–°å¢žç«¯ç‚¹ç¤ºä¾‹

```markdown
## å˜æ›´æ—¥å¿—

### v1.1 (2026-02-13)
- æ–°å¢ž `GET /api/v1/connectors/{id}/tables` ç«¯ç‚¹
- æ–°å¢ž `TableListResponse` ç±»åž‹
- åŽŸå› ï¼šå‰ç«¯éœ€è¦æŸ¥çœ‹è¡¨åˆ—è¡¨

### v1.0 (2026-02-12)
- åˆå§‹ç‰ˆæœ¬
```

### ä¿®æ”¹å­—æ®µç¤ºä¾‹

```markdown
## å˜æ›´æ—¥å¿—

### v2.0 (2026-02-15) âš ï¸ BREAKING CHANGE
- `POST /api/v1/auth/login` å“åº”å­—æ®µå˜æ›´ï¼š
  - âŒ ç§»é™¤: `token` (string)
  - âœ… æ–°å¢ž: `accessToken` (string)
  - åŽŸå› : ç»Ÿä¸€å‘½åè§„èŒƒ
- æ—§ç«¯ç‚¹ä¿ç•™: `POST /api/v1/auth/login` (v1) å°†åºŸå¼ƒäºŽ v2.2

### v1.2 (2026-02-14)
- æ–°å¢žå­—æ®µ
```

---

## âŒ è¿è§„è¡Œä¸ºç¤ºä¾‹

### è¿è§„ 1: å…ˆå†™ä»£ç åŽè¡¥å¥‘çº¦
```
Agent A: å†™äº† POST /api/v1/connectors/test ç«¯ç‚¹
Agent B: æ ¹æ®å¥‘çº¦å†™äº†å‰ç«¯ä»£ç ï¼Œè°ƒç”¨ /test
ç»“æžœï¼šå‰ç«¯è°ƒç”¨ 404ï¼ŒåŠŸèƒ½å¤±æ•ˆ

å¤„ç½šï¼šAgent A å¿…é¡»å›žæ»šä»£ç ï¼Œé‡æ–°æŒ‰æµç¨‹æäº¤
```

### è¿è§„ 2: ç±»åž‹ä¸ä¸€è‡´
```
å¥‘çº¦å®šä¹‰:
  createdAt: string (ISO 8601)

åŽç«¯å®žé™…è¿”å›ž:
  created_at: number (timestamp)

ç»“æžœï¼šå‰ç«¯ TypeScript æŠ¥é”™ï¼ŒåŠŸèƒ½å¤±æ•ˆ

å¤„ç½šï¼šåŽç«¯ Agent ä¿®å¤ï¼Œæ›´æ–°å¥‘çº¦å’Œä»£ç 
```

### è¿è§„ 3: ç ´åæ€§å˜æ›´æ— ç‰ˆæœ¬å‡çº§
```
Agent A: ç›´æŽ¥æŠŠ /api/v1/auth/login æ”¹æˆ /api/v2/auth/login
å‰ç«¯è¿˜åœ¨è°ƒç”¨ /api/v1/auth/login
ç»“æžœï¼šç™»å½•åŠŸèƒ½å½»åº•å¤±æ•ˆ

å¤„ç½šï¼šå¿…é¡»åŒæ—¶ä¿ç•™ä¸¤ä¸ªç‰ˆæœ¬ï¼Œé€æ­¥è¿ç§»
```

---

## âœ… åˆè§„ç¤ºä¾‹

### æ­£ç¡®æµç¨‹ï¼šæ–°å¢žç«¯ç‚¹

**Step 1**: æ›´æ–° API_CONTRACT.md
```markdown
### GET /api/v1/connectors/{id}/tables

**æè¿°**: èŽ·å–æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨

**å“åº”**: TableListResponse

**é”™è¯¯**:
- 404: CONNECTOR_NOT_FOUND
```

**Step 2**: æ›´æ–°ç±»åž‹
```typescript
// types/connector.ts
export interface TableListResponse {
  tables: string[];
  count: number;
}
```

```python
# backend/schemas/connector.py
class TableListResponse(BaseModel):
    tables: list[str]
    count: int
```

**Step 3**: å®žçŽ°ä»£ç 
```python
# backend/endpoints/connectors.py
@router.get("/{id}/tables")
async def get_tables(id: UUID) -> TableListResponse:
    ...
```

**Step 4**: è¿è¡Œæ£€æŸ¥
```bash
./scripts/check-contract.sh
# âœ… All checks passed
```

**Step 5**: æäº¤
```bash
git add API_CONTRACT.md types/connector.ts backend/
git commit -m "feat: add GET /connectors/{id}/tables endpoint

- Add table listing functionality
- Update API_CONTRACT.md v1.1
- Add TypeScript and Python types"
```

---

## ðŸš¨ ç´§æ€¥ä¿®å¤æµç¨‹

å¦‚æžœå‘çŽ°çº¿ä¸ŠçŽ¯å¢ƒä¸Žå¥‘çº¦ä¸ç¬¦ï¼š

1. **ç«‹å³å†»ç»“**ï¼šåœæ­¢ç›¸å…³åŠŸèƒ½çš„è¿›ä¸€æ­¥å¼€å‘
2. **å®šä½é—®é¢˜**ï¼šç¡®å®šæ˜¯å¥‘çº¦è¿‡æ—¶è¿˜æ˜¯ä»£ç é”™è¯¯
3. **å†³ç­–**ï¼š
   - å¦‚æžœæ˜¯ä»£ç é”™è¯¯ â†’ ä¿®å¤ä»£ç 
   - å¦‚æžœæ˜¯å¥‘çº¦æœªæ›´æ–° â†’ æ›´æ–°å¥‘çº¦
4. **åŒæ­¥**ï¼šç¡®ä¿å‰åŽç«¯éƒ½åŒæ­¥åˆ°æ­£ç¡®ç‰ˆæœ¬
5. **éªŒè¯**ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•
6. **æ–‡æ¡£**ï¼šè®°å½•é—®é¢˜åŽŸå› ï¼Œé˜²æ­¢å†æ¬¡å‘ç”Ÿ

---

## ðŸ“Š å¥‘çº¦ç‰ˆæœ¬ç®¡ç†

```
API_CONTRACT.md
â”œâ”€â”€ å½“å‰ç‰ˆæœ¬: v1.0
â”œâ”€â”€ çŠ¶æ€: æ´»è·ƒ
â””â”€â”€ åŽ†å²:
    â”œâ”€â”€ v0.9 (åºŸå¼ƒ)
    â””â”€â”€ v0.8 (åºŸå¼ƒ)

å˜æ›´è§„åˆ™:
- PATCH (x.x.1): æ— éœ€å®¡æ‰¹
- MINOR (x.1.x): éœ€è¦ä¸»ç®¡ç¡®è®¤
- MAJOR (2.x.x): éœ€è¦å›¢é˜Ÿè¯„å®¡
```

---

## ðŸ‘¥ Agent è´£ä»»

| Agent è§’è‰² | è´£ä»» |
|------------|------|
| **Backend Agent** | ç¡®ä¿ Python Schema ä¸Žå¥‘çº¦ä¸€è‡´ |
| **Frontend Agent** | ç¡®ä¿ TypeScript ç±»åž‹ä¸Žå¥‘çº¦ä¸€è‡´ |
| **API Contract Agent** | ç»´æŠ¤å¥‘çº¦æ–‡æ¡£ï¼Œå®¡æ ¸å˜æ›´ |
| **Project Lead** | ç›‘ç£æ‰§è¡Œï¼Œå¤„ç†è¿è§„ |

---

## ðŸ”§ å·¥å…·æ”¯æŒ

### è‡ªåŠ¨æ£€æŸ¥ï¼ˆæŽ¨èï¼‰
```bash
# æ·»åŠ åˆ° git pre-commit hook
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash
./scripts/check-contract.sh || exit 1
EOF
chmod +x .git/hooks/pre-commit
```

### CI/CD é›†æˆ
```yaml
# .github/workflows/ci.yml
- name: Check API Contract
  run: ./scripts/check-contract.sh
```

---

## ðŸ“ž äº‰è®®è§£å†³

å¦‚æžœ Agent ä¹‹é—´å¯¹å¥‘çº¦ç†è§£æœ‰åˆ†æ­§ï¼š

1. æš‚åœç›¸å…³å¼€å‘
2. å¬å¼€ç®€çŸ­è¯„å®¡ï¼ˆç”¨å½“å‰ä¼šè¯ä¸Šä¸‹æ–‡ï¼‰
3. æ˜Žç¡®å†³ç­–å¹¶æ›´æ–°å¥‘çº¦
4. ç»§ç»­å¼€å‘

**æœ€ç»ˆå†³ç­–æƒ**ï¼šProject Lead (Tagilla)

---

## ðŸŽ“ æ–° Agent å…¥èŒ

æ–°åŠ å…¥é¡¹ç›®çš„ Agent å¿…é¡»ï¼š

1. é˜…è¯» API_CONTRACT.md
2. ç†è§£æ‰€æœ‰ç±»åž‹å®šä¹‰
3. è¿è¡Œæ£€æŸ¥è„šæœ¬ç¡®ä¿çŽ¯å¢ƒæ­£å¸¸
4. ä»Žç®€å•ç«¯ç‚¹å¼€å§‹ï¼ˆå¦‚ GET è¯·æ±‚ï¼‰
5. é¦–æ¬¡æäº¤å¿…é¡»ç»ä¸»ç®¡å®¡æ ¸

---

**ç”Ÿæ•ˆæ—¥æœŸ**: 2026-02-12  
**ç‰ˆæœ¬**: v1.0  
**å¼ºåˆ¶æ‰§è¡Œ**: âœ… æ˜¯

---

*è¿åæœ¬æŒ‡å—å¯¼è‡´çš„ç”Ÿäº§äº‹æ•…ï¼Œç”±è¿è§„ Agent æ‰¿æ‹…å…¨éƒ¨è´£ä»»ã€‚*
